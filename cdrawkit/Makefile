all : capp simple capp_sf.h

#for X11 consider:             xorg-dev
#for X11, you will need:       libx-dev
#for full screen you'll need:  libxinerama-dev libxext-dev
#for OGL You'll need:          mesa-common-dev libglu1-mesa-dev

#-DCAPPRASTERIZER
#  and
#-CAPPOGL
#  are incompatible.


MINGW32:=/usr/bin/i686-w64-mingw32

capp-clang.exe: capp.c
	clang capp.c -o capp-clang.exe -g -O1 -Icapp -lopengl32 -lgdi32 -luser32 

cappogl-clang.exe: capp.c
	clang capp.c -o cappogl-clang.exe -g -O1 -Icapp -DCAPPOGL -lopengl32 -lgdi32 -luser32 

capp.exe : capp.c
	$(MINGW32)gcc -g -m32 -o $@ $^  -lgdi32

cappogl.exe : capp.c
	$(MINGW32)gcc -g -m32 -o $@ $^  -lgdi32 -DCAPPOGL -lopengl32

capp_egl : capp.c
	gcc -o $@ $^ -lMali -lpthread -lm -O3

simple : simple.c
	gcc -o $@ $^ -lX11 -lpthread -lXinerama -lXext -lGL -g -lm -ldl

capp : capp.c
	gcc -o $@ $^ -lX11 -lpthread -lXinerama -lXext -lGL -g -lm -ldl

capp_ogl : capp.c
	gcc -o $@ $^ -lX11 -lpthread -lXinerama -lXext -lGL -g -DCAPPOGL -lm -ldl

osdtest : osdtest.c CAPP.c
	gcc -o $@ $^ -lX11 -lpthread -lXinerama -lXext -DCAPP_HAS_XINERAMA -DCAPP_HAS_XSHAPE -lm -ldl

ogltest : ogltest.c CAPP.c
	gcc -o $@ $^  -lX11 -lXinerama -lGL   -DCAPPOGL -lm

capp_http : capp.c tools/capp_http_page.h
	$(CC) -o $@ $< -DCAPPHTTP -lm -ldl -Os -s

tools/binary_to_buffer : tools/binary_to_buffer.c
	$(CC) -o $@ $^

tools/capp_http_page.h : tools/capp_http_files/index.html tools/binary_to_buffer
	cat $< | gzip -9 | tools/binary_to_buffer webpage_buffer > $@

ogltest.exe : ogltest.c CAPP.c
	$(MINGW32)gcc -o $@ $^ -lgdi32 -lkernel32 -lopengl32 -DCAPPOGL -lm

tools/single_file_creator : tools/single_file_creator.c
	gcc -o $@ $^

capp_sf.h : tools/single_file_creator CAPP.h tools/capp_http_page.h
	echo "//This file was automatically generated by Makefile at https://github.com/cntools/capp" > $@
	echo "//This single-file feature is still in early alpha testing." >> $@f
	echo "//Generated from files git hash $(shell git rev-parse HEAD) on $(shell date) (This is not the git hash of this file)" >> $@
	./tools/single_file_creator CAPP.h CAPP.c CAPPWinDriver.c CAPPEGLLeanAndMean.c CAPPRasterizer.c CAPPEGLDriver.c CAPPWASMDriver.c CAPPXDriver.c CAPPFunctions.c CAPP3D.c CAPPAndroid.h CAPPHTTP.c tools/capp_http_page.h >> $@

clean : 
	rm -rf *.o *~ capp.exe cappogl.exe capp capp_ogl capp_mac capp_mac_soft capp_mac_cg capp_mac_ogl ogltest ogltest.exe capp_egl capp_http capp_sf.h tools/single_file_creator tools/binary_to_buffer tools/capp_http_page.h

